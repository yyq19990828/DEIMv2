# DEIMv2 DINOv3-X è‡ªå®šä¹‰æ•°æ®é›†è®­ç»ƒæŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨DEIMv2æ¡†æ¶åœ¨è‡ªå®šä¹‰æ•°æ®é›†ä¸Šè®­ç»ƒã€æµ‹è¯•å’Œå¾®è°ƒDINOv3-Xæ¨¡å‹ã€‚

## ğŸ“‹ ç›®å½•

- [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
- [æ•°æ®é›†è½¬æ¢](#æ•°æ®é›†è½¬æ¢)
- [æ¨¡å‹è®­ç»ƒ](#æ¨¡å‹è®­ç»ƒ)
- [æ¨¡å‹æµ‹è¯•](#æ¨¡å‹æµ‹è¯•)
- [æ¨¡å‹å¾®è°ƒ](#æ¨¡å‹å¾®è°ƒ)
- [è„šæœ¬è¯´æ˜](#è„šæœ¬è¯´æ˜)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸš€ å‰ç½®å‡†å¤‡

### 1. ç¯å¢ƒè®¾ç½®
```bash
conda create -n deimv2 python=3.11 -y
conda activate deimv2
pip install -r requirements.txt
```

### 2. æ•°æ®é›†å‡†å¤‡
ç¡®ä¿æ‚¨çš„æ•°æ®é›†æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š
```
dataset/
â”œâ”€â”€ data/           # å›¾åƒæ–‡ä»¶
â”‚   â”œâ”€â”€ 00000.jpg
â”‚   â”œâ”€â”€ 00001.jpg
â”‚   â””â”€â”€ ...
â””â”€â”€ label/          # æ ‡æ³¨æ–‡ä»¶ï¼ˆJSONæ ¼å¼ï¼‰
    â”œâ”€â”€ 00000.json
    â”œâ”€â”€ 00001.json
    â””â”€â”€ ...
```

### 3. é¢„è®­ç»ƒæƒé‡ä¸‹è½½
ä¸‹è½½DINOv3é¢„è®­ç»ƒæƒé‡å¹¶æ”¾ç½®åˆ°`./ckpts/`ç›®å½•ï¼š
```bash
mkdir -p ckpts
# ä¸‹è½½ dinov3_vits16plus_pretrain_lvd1689m-4057cbaa.pth
# æ”¾ç½®åˆ° ckpts/ ç›®å½•ä¸‹
```

## ğŸ“Š æ•°æ®é›†è½¬æ¢

é¦–å…ˆå°†è‡ªå®šä¹‰æ ¼å¼çš„æ•°æ®é›†è½¬æ¢ä¸ºCOCOæ ¼å¼ï¼š

```bash
# è½¬æ¢æ•°æ®é›†ï¼ˆè‡ªåŠ¨åˆ›å»ºè®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†ï¼‰
./scripts/convert_dataset_simple.sh

# æˆ–è€…æŒ‡å®šè‡ªå®šä¹‰è·¯å¾„
./scripts/convert_dataset_simple.sh -d your_data_dir -l your_label_dir -o your_output_dir
```

è½¬æ¢å®Œæˆåï¼Œä¼šåœ¨`dataset/coco_format/`ç›®å½•ä¸‹ç”Ÿæˆï¼š
- `instances_train.json` - è®­ç»ƒé›†æ ‡æ³¨
- `instances_val.json` - éªŒè¯é›†æ ‡æ³¨ï¼ˆä»è®­ç»ƒé›†å¤åˆ¶5000å¼ ï¼‰
- `instances_test.json` - æµ‹è¯•é›†æ ‡æ³¨ï¼ˆä»è®­ç»ƒé›†å¤åˆ¶5000å¼ ï¼‰

## ğŸ‹ï¸ æ¨¡å‹è®­ç»ƒ

### åŸºç¡€è®­ç»ƒ
```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°è®­ç»ƒ
./scripts/train_dinov3_x_custom.sh

# ä½¿ç”¨2ä¸ªGPUè®­ç»ƒ
./scripts/train_dinov3_x_custom.sh -g 0,1 -n 2

# ç¦ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
./scripts/train_dinov3_x_custom.sh --no-amp

# æŒ‡å®šè¾“å‡ºç›®å½•
./scripts/train_dinov3_x_custom.sh -o ./my_training_outputs
```

### æ¢å¤è®­ç»ƒ
```bash
# ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ
./scripts/train_dinov3_x_custom.sh -r outputs/model_epoch_10.pth
```

### è®­ç»ƒå‚æ•°è¯´æ˜
- `-c, --config`: é…ç½®æ–‡ä»¶è·¯å¾„
- `-g, --gpus`: GPUè®¾å¤‡åˆ—è¡¨ï¼ˆå¦‚ï¼š0,1,2,3ï¼‰
- `-n, --nproc`: æ¯ä¸ªèŠ‚ç‚¹çš„è¿›ç¨‹æ•°
- `--no-amp`: ç¦ç”¨è‡ªåŠ¨æ··åˆç²¾åº¦è®­ç»ƒ
- `-s, --seed`: éšæœºç§å­
- `-o, --output`: è¾“å‡ºç›®å½•
- `-r, --resume`: æ¢å¤è®­ç»ƒçš„æ£€æŸ¥ç‚¹è·¯å¾„

## ğŸ§ª æ¨¡å‹æµ‹è¯•

```bash
# åŸºç¡€æµ‹è¯•
./scripts/test_dinov3_x_custom.sh -r model.pth

# ä½¿ç”¨2ä¸ªGPUæµ‹è¯•
./scripts/test_dinov3_x_custom.sh -r model.pth -g 0,1 -n 2

# æŒ‡å®šè¾“å‡ºç›®å½•
./scripts/test_dinov3_x_custom.sh -r model.pth -o ./test_results
```

### æµ‹è¯•å‚æ•°è¯´æ˜
- `-r, --model`: æ¨¡å‹æ£€æŸ¥ç‚¹è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
- `-c, --config`: é…ç½®æ–‡ä»¶è·¯å¾„
- `-g, --gpus`: GPUè®¾å¤‡åˆ—è¡¨
- `-n, --nproc`: æ¯ä¸ªèŠ‚ç‚¹çš„è¿›ç¨‹æ•°
- `-o, --output`: è¾“å‡ºç›®å½•

## ğŸ”§ æ¨¡å‹å¾®è°ƒ

```bash
# åŸºç¡€å¾®è°ƒ
./scripts/finetune_dinov3_x_custom.sh -t pretrained_model.pth

# ä½¿ç”¨2ä¸ªGPUå¾®è°ƒ
./scripts/finetune_dinov3_x_custom.sh -t model.pth -g 0,1 -n 2

# ç¦ç”¨æ··åˆç²¾åº¦å¾®è°ƒ
./scripts/finetune_dinov3_x_custom.sh -t model.pth --no-amp

# æŒ‡å®šè¾“å‡ºç›®å½•
./scripts/finetune_dinov3_x_custom.sh -t model.pth -o ./finetune_outputs
```

### å¾®è°ƒå‚æ•°è¯´æ˜
- `-t, --pretrained`: é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
- `-c, --config`: é…ç½®æ–‡ä»¶è·¯å¾„
- `-g, --gpus`: GPUè®¾å¤‡åˆ—è¡¨
- `-n, --nproc`: æ¯ä¸ªèŠ‚ç‚¹çš„è¿›ç¨‹æ•°
- `--no-amp`: ç¦ç”¨è‡ªåŠ¨æ··åˆç²¾åº¦è®­ç»ƒ
- `-s, --seed`: éšæœºç§å­
- `-o, --output`: è¾“å‡ºç›®å½•

## ğŸ“ è„šæœ¬è¯´æ˜

### é…ç½®æ–‡ä»¶
- `configs/deimv2/deimv2_dinov3_x_custom.yml`: DINOv3-Xæ¨¡å‹é…ç½®
- `configs/dataset/custom_dataset.yml`: è‡ªå®šä¹‰æ•°æ®é›†é…ç½®

### æ ¸å¿ƒè„šæœ¬
1. **`convert_dataset_simple.sh`**: æ•°æ®é›†æ ¼å¼è½¬æ¢
2. **`train_dinov3_x_custom.sh`**: æ¨¡å‹è®­ç»ƒ
3. **`test_dinov3_x_custom.sh`**: æ¨¡å‹æµ‹è¯•
4. **`finetune_dinov3_x_custom.sh`**: æ¨¡å‹å¾®è°ƒ

### æ•°æ®é›†é…ç½®
è‡ªå®šä¹‰æ•°æ®é›†åŒ…å«14ä¸ªé¢„å®šä¹‰ç±»åˆ«ï¼š
1. car (å°æ±½è½¦)
2. truck (è´§è½¦)
3. construction_truck (å·¥ç¨‹è½¦è¾†)
4. van (å¢å¼é¢åŒ…è½¦)
5. bus (å·´å£«)
6. bicycle (ä¸¤è½®è½¦)
7. cyclist (ä¸¤è½®è½¦éª‘è¡Œè€…)
8. tricycle (ä¸‰è½®è½¦ã€ä¸‰è½®è½¦éª‘è¡Œè€…)
9. trolley (æ‰‹æ¨è½¦)
10. pedestrian (è¡Œäºº)
11. cone (é”¥å½¢æ¡¶ã€æŸ±å½¢æ¡¶)
12. barrier (æ°´é©¬ã€æ …æ )
13. animal (å°åŠ¨ç‰©)
14. other (å…¶ä»–)

## â“ å¸¸è§é—®é¢˜

### Q1: è®­ç»ƒæ—¶å‡ºç°CUDAå†…å­˜ä¸è¶³é”™è¯¯
**A**: å°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š
- å‡å°‘GPUæ•°é‡ï¼š`-g 0,1 -n 2`
- ç¦ç”¨æ··åˆç²¾åº¦ï¼š`--no-amp`
- ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„batch_size

### Q2: æ•°æ®é›†è½¬æ¢å¤±è´¥
**A**: æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š
- ç¡®ä¿å›¾åƒå’Œæ ‡æ³¨æ–‡ä»¶ä¸€ä¸€å¯¹åº”
- æ£€æŸ¥JSONæ ‡æ³¨æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®ä¿å›¾åƒæ–‡ä»¶å¯ä»¥æ­£å¸¸è¯»å–

### Q3: æ¨¡å‹è®­ç»ƒæ”¶æ•›æ…¢æˆ–ä¸æ”¶æ•›
**A**: å°è¯•ä»¥ä¸‹è°ƒæ•´ï¼š
- æ£€æŸ¥å­¦ä¹ ç‡è®¾ç½®
- ç¡®è®¤æ•°æ®é›†è´¨é‡å’Œæ ‡æ³¨å‡†ç¡®æ€§
- è€ƒè™‘ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒ

### Q4: å¦‚ä½•ç›‘æ§è®­ç»ƒè¿›åº¦
**A**: è®­ç»ƒæ—¥å¿—ä¼šä¿å­˜åœ¨è¾“å‡ºç›®å½•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨tensorboardæˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ç›‘æ§è®­ç»ƒè¿›åº¦ã€‚

### Q5: å¦‚ä½•è°ƒæ•´è®­ç»ƒå‚æ•°
**A**: ä¿®æ”¹é…ç½®æ–‡ä»¶`configs/deimv2/deimv2_dinov3_x_custom.yml`ä¸­çš„ç›¸å…³å‚æ•°ï¼Œå¦‚å­¦ä¹ ç‡ã€è®­ç»ƒè½®æ•°ç­‰ã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹DEIMv2é¡¹ç›®çš„GitHub Issues
3. ç¡®ä¿ç¯å¢ƒé…ç½®æ­£ç¡®

## ğŸ¯ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

```bash
# 1. è½¬æ¢æ•°æ®é›†
./scripts/convert_dataset_simple.sh

# 2. è®­ç»ƒæ¨¡å‹
./scripts/train_dinov3_x_custom.sh

# 3. æµ‹è¯•æ¨¡å‹
./scripts/test_dinov3_x_custom.sh -r outputs/deimv2_dinov3_x_custom/model_final.pth

# 4. å¾®è°ƒæ¨¡å‹ï¼ˆå¯é€‰ï¼‰
./scripts/finetune_dinov3_x_custom.sh -t pretrained_model.pth
```

ç¥æ‚¨è®­ç»ƒé¡ºåˆ©ï¼ğŸš€